{# ========================================
   SECTION 1 : ANALYSE DE L'ERREUR
   ======================================== #}

âš ï¸ ATTENTION : Nombre de paires de guillemets INCORRECT

Tu es un traducteur professionnel. Ta traduction prÃ©cÃ©dente a Ã©chouÃ© car tu n'as PAS prÃ©servÃ© le nombre de paires de guillemets.

---

## ğŸ“Š ANALYSE DE L'ERREUR

**Texte original** :
{{ original_text }}

**Ta traduction INCORRECTE** :
{{ incorrect_translation }}

âŒ **ERREUR DÃ‰TECTÃ‰E** :
- Paires de guillemets attendues : {{ expected_pairs }}
- Paires dans ta traduction : {{ actual_pairs }}

{% if actual_pairs < expected_pairs %}
ğŸ’¡ Il te manque **{{ expected_pairs - actual_pairs }} paire(s)** de guillemets.
â†’ Tu as probablement **fusionnÃ©** plusieurs dialogues en un seul bloc.
{% elif actual_pairs > expected_pairs %}
ğŸ’¡ Tu as **{{ actual_pairs - expected_pairs }} paire(s) en trop**.
â†’ Tu as probablement **divisÃ©** un dialogue continu ou ajoutÃ© des guillemets superflus.
{% endif %}

---

{# ========================================
   SECTION 2 : RÃˆGLE CRITIQUE
   ======================================== #}

## ğŸ”´ RÃˆGLE ABSOLUE : PrÃ©server EXACTEMENT le nombre de paires

{% if expected_pairs == 0 %}
Le texte original **ne contient AUCUN guillemet**.

Ta traduction NE DOIT PAS contenir de guillemets.

âœ… **AutorisÃ©** :
- Traduire comme un texte narratif normal
- Utiliser la ponctuation standard (virgules, points, etc.)

âŒ **INTERDIT** :
- Ajouter des guillemets pour encadrer des mots ou phrases

{% elif expected_pairs == 1 %}
Le texte original contient **EXACTEMENT 1 paire de guillemets**.

Ta traduction DOIT contenir **EXACTEMENT 1 paire**.

âœ… **Structure attendue** :
- **Dialogue simple** : `â€œHelloâ€` â†’ `Â« Bonjour Â»`
- **Dialogue continu** : Un seul bloc de dialogue

âŒ **INTERDIT** :
- Diviser le dialogue en plusieurs paires
- Supprimer les guillemets

{% else %}
Le texte original contient **EXACTEMENT {{ expected_pairs }} paires de guillemets**.

Ta traduction DOIT contenir **EXACTEMENT {{ expected_pairs }} paires**.

âœ… **Structure attendue** :
- **Dialogue interrompu** : `â€œA,â€ he said, â€œBâ€` â†’ `Â« A Â», dit-il, Â« B Â»` (2 paires)
- **Multiples dialogues** : `â€œAâ€ she said. â€œBâ€ he replied.` â†’ `Â« A Â», dit-elle. Â« B Â», rÃ©pondit-il.` (2 paires)

ğŸ¯ **Points critiques** :
1. Si le narrateur interrompt le dialogue (`â€œA,â€ he said, â€œBâ€`), tu DOIS prÃ©server cette interruption
2. Chaque dialogue sÃ©parÃ© DOIT avoir sa propre paire de guillemets
3. Ne fusionne PAS plusieurs dialogues en un seul bloc

âŒ **INTERDIT** :
- Fusionner dialogues interrompus : `â€œA,â€ he said, â€œBâ€` â†’ `Â« A, dit-il, B Â»` âŒ
- Supprimer des paires de guillemets

{% endif %}

---

{# ========================================
   SECTION 3 : EXEMPLE SPÃ‰CIFIQUE
   ======================================== #}

## ğŸ’¡ Exemple pour ton cas ({{ expected_pairs }} paire(s))

{% if expected_pairs == 0 %}
**Exemple : Texte sans guillemets**

Original (0 paire) :
```
The cat slept peacefully on the couch.
```

âœ… CORRECT (0 paire) :
```
Le chat dormait paisiblement sur le canapÃ©.
```

âŒ INCORRECT (1 paire ajoutÃ©e par erreur) :
```
Le chat Â« dormait paisiblement Â» sur le canapÃ©.
```

{% elif expected_pairs == 1 %}
**Exemple : Dialogue simple**

Original (1 paire) :
```
â€œHello, world!â€
```

âœ… CORRECT (1 paire) :
```
Â« Bonjour, monde ! Â»
```

âŒ INCORRECT (dialogue divisÃ© en 2 paires) :
```
Â« Bonjour Â», Â« monde Â» !
```

{% elif expected_pairs == 2 %}
**Exemple : Dialogue interrompu**

Original (2 paires) :
```
â€œYou can think,â€ she said, â€œafter you arrest him!â€
```

âŒ INCORRECT (fusion en 1 paire) :
```
Â« Tu peux penser, dit-elle, aprÃ¨s l'avoir arrÃªtÃ© ! Â»
```
â†’ Le narrateur `she said` n'est plus sÃ©parÃ© du dialogue

âœ… CORRECT (2 paires prÃ©servÃ©es) :
```
Â« Tu peux penser Â», dit-elle, Â« aprÃ¨s l'avoir arrÃªtÃ© ! Â»
```
â†’ Structure claire : [Dialogue 1] [Narrateur] [Dialogue 2]

**Exemple 2bis : PensÃ©es intÃ©rieures + dialogues avec sÃ©parateurs (CRITIQUE)**

Original (2 paires, 5 sÃ©parateurs `</>`) :
```
He declined a reward</>, she thought, </>but I really must find </>some </>way to pay him back...</> â€œYes,â€ she said, finally. â€œThat would indeed be the adventurer I hired.â€
```

âŒ INCORRECT (guillemets ajoutÃ©s aux pensÃ©es + sÃ©parateurs supprimÃ©s) :
```
Â« Il a refusÃ© une rÃ©compense Â», pensa-t-elle, Â« mais je dois vraiment trouver un moyen de le rembourser... Â» Â« Oui Â», dit-elle finalement. Â« Ce serait effectivement l'aventurier que j'ai engagÃ©. Â»
```
â†’ ERREUR 1 : 4 paires de guillemets au lieu de 2 (pensÃ©es en guillemets âŒ)
â†’ ERREUR 2 : 0 sÃ©parateurs `</>` au lieu de 5 (tous supprimÃ©s âŒ)

âœ… CORRECT (2 paires aux positions des dialogues, 5 sÃ©parateurs prÃ©servÃ©s) :
```
Il a refusÃ© une rÃ©compense</>, pensa-t-elle, </>mais je dois vraiment trouver </>un </>moyen de le rembourser...</> Â« Oui Â», dit-elle finalement. Â« Ce serait effectivement l'aventurier que j'ai engagÃ©. Â»
```
â†’ Seulement 2 paires de guillemets (aux dialogues `â€œYesâ€` et `â€œThat wouldâ€`) âœ…
â†’ 5 sÃ©parateurs `</>` prÃ©servÃ©s exactement aux mÃªmes positions âœ…
â†’ PensÃ©es intÃ©rieures SANS guillemets (comme l'original) âœ…

ğŸ’¡ **RÃ¨gles critiques** :
1. **Guillemets seulement aux positions EXACTES** oÃ¹ l'original en a (ne pas ajouter aux pensÃ©es)
2. **TOUS les sÃ©parateurs `</>`** doivent Ãªtre prÃ©servÃ©s (ne jamais les supprimer)
3. Si texte SANS guillemets dans l'original (pensÃ©es, narration) â†’ NE PAS ajouter guillemets

{% elif expected_pairs == 3 %}
**Exemple : 3 paires de guillemets**

Original (3 paires) :
```
â€œI'll never forget it. At first I thought Balirossa had just gotten a little overzealous and charged in too far.â€ The two of them burst into laughter. â€œSo Rys,â€ Flio said, â€œwhat are you in the mood for today?â€
```

Structure des 3 paires :
- Paire 1 : `â€œI'll never forget it. ... too far.â€` (dialogue complet)
- Paire 2 : `â€œSo Rys,â€` (dialogue interrompu - partie 1)
- Paire 3 : `â€œwhat are you in the mood for today?â€` (dialogue interrompu - partie 2)

âœ… CORRECT (3 paires prÃ©servÃ©es) :
```
Â« Je n'oublierai jamais Ã§a. Au dÃ©but, j'ai cru que Balirossa s'Ã©tait juste un peu trop enthousiasmÃ©e et avait chargÃ© trop loin. Â» Tous deux Ã©clatÃ¨rent de rire. Â« Alors Rys, Â» dit Flio, Â« qu'as-tu envie de faire aujourd'hui ? Â»
```

ğŸ’¡ **Astuce** : NumÃ©rote mentalement chaque paire dans l'original (P1, P2, P3) avant de traduire !

{% elif expected_pairs == 4 %}
**Exemple : 4 paires de guillemets**

Original (4 paires) :
```
â€œFirst dialogue,â€ he said. â€œSecond dialogue,â€ she replied, â€œthird part,â€ he ended the discussion, â€œfourth part.â€
```

Structure des 4 paires :
- Paire 1 (P1) : `â€œFirst dialogue,â€`
- Paire 2 (P2) : `â€œSecond dialogue,â€`
- Paire 3 (P3) : `â€œthird part.â€` (dÃ©but interrompu)
- Paire 4 (P4) : (suite de l'interruption)

MÃ©thode : NumÃ©rote chaque ouverture `â€œ` dans l'original â†’ P1, P2, P3, P4

âœ… CORRECT (4 paires prÃ©servÃ©es) :
```
Â« Premier dialogue Â», dit-il. Â« DeuxiÃ¨me dialogue Â», rÃ©pondit-elle, Â« troisiÃ¨me partie Â», il mit fin Ã  la discussion, Â« quatriÃ¨me partie. Â»
```

ğŸ’¡ **Astuce** : Pour 4+ paires, numÃ©rote chaque `â€œ` ouvrant dans l'original (P1, P2, P3, P4) avant de traduire !

{% else %}
**Exemple : Multiples paires ({{ expected_pairs }} paires)**

Original ({{ expected_pairs }} paires) :
```
Texte avec {{ expected_pairs }} paires de guillemets bien sÃ©parÃ©es.
```

âœ… CORRECT ({{ expected_pairs }} paires) :
```
Traduction avec EXACTEMENT {{ expected_pairs }} paires de guillemets.
```

ğŸ’¡ **ProcÃ©dure pour 5+ paires** :
1. NumÃ©rote chaque guillemet ouvrant dans l'original : P1, P2, P3, P4, P5...
2. Identifie oÃ¹ chaque paire se ferme (dialogue complet ou interrompu)
3. PrÃ©serve EXACTEMENT la mÃªme structure dans ta traduction
4. VÃ©rifie que tu as bien {{ expected_pairs }} paires avant de rÃ©pondre

{% endif %}

---

{# ========================================
   SECTION 4 : FORMAT DE SORTIE EXACT
   ======================================== #}

## ğŸ¯ FORMAT DE SORTIE EXACT

{% if expected_pairs == 0 %}
**Structure attendue** : Texte continu SANS aucun guillemet

Exemple :
```
Le chat dort sur le canapÃ©. Il ronfle doucement.
```

{% elif expected_pairs == 1 %}
**Structure attendue** : UNE ouverture Â« et UNE fermeture Â»

Exemple :
```
Â« Bonjour le monde ! Â»
```

{% elif expected_pairs == 2 %}
**Structure attendue** : DEUX ouvertures Â« et DEUX fermetures Â»

Si dialogue interrompu, structure OBLIGATOIRE :
```
Â« Partie 1 Â» narrateur Â« Partie 2 Â»
```

âš ï¸ ATTENTION : Les guillemets doivent ENTOURER seulement le dialogue, PAS le narrateur !

âŒ INCORRECT :
```
Â« Partie 1 narrateur Partie 2 Â»
```
â†’ Le narrateur est DANS les guillemets (fusion) âŒ

âœ… CORRECT :
```
Â« Partie 1 Â» narrateur Â« Partie 2 Â»
```
â†’ Le narrateur est HORS des guillemets (interruption prÃ©servÃ©e) âœ…

{% elif expected_pairs >= 3 %}
**Structure attendue** : {{ expected_pairs }} ouvertures Â« et {{ expected_pairs }} fermetures Â»

Pour {{ expected_pairs }} paires, tu DOIS avoir :
- {{ expected_pairs }} symboles Â« (guillemets ouvrants)
- {{ expected_pairs }} symboles Â» (guillemets fermants)

ğŸ“ **MÃ‰THODE DE VÃ‰RIFICATION OBLIGATOIRE** :

AVANT de finaliser ta rÃ©ponse, COMPTE manuellement :

1ï¸âƒ£ Compte les Â« dans ta traduction : _______
2ï¸âƒ£ Compte les Â» dans ta traduction : _______
3ï¸âƒ£ VÃ©rifie : Si les deux nombres = {{ expected_pairs }} â†’ âœ… OK
4ï¸âƒ£ Sinon â†’ ğŸ”´ ERREUR, corrige immÃ©diatement !

**Exemple de structure pour {{ expected_pairs }} paires** :

Si dialogues interrompus :
```
Â« P1 Â» narrateur Â« P2 Â» narrateur. Â« P3 Â» narrateur Â« P4 Â»
```

Si dialogues sÃ©parÃ©s :
```
Â« P1 Â» narrateur. Â« P2 Â» narrateur. Â« P3 Â» narrateur. Â« P4 Â»
```

âš ï¸ RÃˆGLE CRITIQUE : Chaque Â« doit avoir sa Â» correspondante !

{% endif %}

---

{# ========================================
   SECTION 5 : RE-TRADUCTION DEMANDÃ‰E
   ======================================== #}

## ğŸ”„ RE-TRADUCTION DEMANDÃ‰E

Re-traduis le texte en **{{ target_language }}** en prÃ©servant STRICTEMENT le nombre de paires de guillemets.

{% if expected_pairs == 0 %}
**Nombre de paires requis** : AUCUNE (texte sans guillemets)
{% else %}
**Nombre de paires requis** : EXACTEMENT {{ expected_pairs }}
{% endif %}

**Texte Ã  re-traduire** :
{{ original_text }}

---

{# ========================================
   SECTION 6 : CHECKLIST
   ======================================== #}

## âœ… CHECKLIST POST-GÃ‰NÃ‰RATION

âš ï¸ **IMPORTANT** : VÃ©rifie APRÃˆS avoir Ã©crit ta traduction complÃ¨te !

{% if expected_pairs == 0 %}
- [ ] Ma traduction ne contient AUCUN guillemet (ni `Â«`, ni `Â»`)
- [ ] C'est un texte narratif normal
{% else %}
- [ ] J'ai COMPTÃ‰ mes guillemets ouvrants Â« : j'en ai exactement {{ expected_pairs }}
- [ ] J'ai COMPTÃ‰ mes guillemets fermants Â» : j'en ai exactement {{ expected_pairs }}
- [ ] Chaque Â« a bien sa Â» correspondante
{% if expected_pairs >= 2 %}
- [ ] Si dialogue interrompu, le narrateur est HORS des guillemets (pas fusionnÃ©)
- [ ] Chaque dialogue sÃ©parÃ© a sa propre paire distincte
{% endif %}
{% endif %}
- [ ] Je termine par `[=[END]=]`

---

âš ï¸ **RAPPEL CRITIQUE** : {{ expected_pairs }} paire(s) requise(s) (pas plus, pas moins)

ğŸ”´ **DERNIÃˆRE VÃ‰RIFICATION** : Compte les Â« et Â» dans ta rÃ©ponse ci-dessous AVANT de la finaliser !

Corrige la traduction incorrecte maintenant :
